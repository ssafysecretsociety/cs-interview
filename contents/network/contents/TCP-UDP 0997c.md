# TCP, UDP

TCP, UDP 모두 transport 계층에서 작동한다.

# UDP

`UDP(User Datagram Protocol)`  비연결형 프로토콜

### 특징

- 전송 순서를 보장하지 않음
- 통신방식: 1:1,  1:N,  N:N
- 신뢰성이 낮다
- 속도가 빠르다

### 전송방식

- ACK(응답), 재전송, 타임아웃을 제공하지 않음
- 혼잡제어, 흐름제어를 제공하지 않음

### 사용처

- DNS
- 실시간 스트리밍
- 음성 인터넷 프로토콜
- 대다수의 온라인 게임
- 속도가 신뢰도보다 우선이 되는 서비스

### 오류검출

헤더의 `Checksum` 필드를 통해 오류 검출 → 최근에는 CRC (순환중복검사)방식으로 확장

1. 세그먼트 수신
2. wraparound 바이트 생성
    1. 수신측에서 보낸 헤더값 중 체크섬을 제외하고 16비트로 나눈다
    2. 16비트 값들을 모두 더한다 캐리가 발생하면 더한다.

1. 오류 검출
    1. 수신측에서 전송한 checksum 바이트와 wraparound 처리된 바이트를 더한다
    2. carry가 발생한다면 버린다
    3. 모든 bit 값이 1이라면 정상이다.

![Untitled](TCP,%20UDP%200997c/Untitled.png)

- 체크섬 바이트 생성 의문점
    
    1의보수, 2의보수, carry 더하기 등 checksum을 만드는 방식에는 서비스마다 차이가 있는 것으로 보임
    

### 전송 세그먼트 구조

![Untitled](TCP,%20UDP%200997c/Untitled%201.png)

# TCP

`TCP(Transmission Control Protocol)` 전송 제어 프로토콜

### 특징

- 전송 순서를 보장한다
- 통신방식: 1:1
- 신뢰성이 높다 (ACK, Sequence Number 활용)
- 속도가 느리다

- 흐름제어(Flow Control)
    
    송신-수신의 데이터 처리 속도의 차이를 해결하기 위한 기법
    
    - 송신측이 수신측보다 속도가 빠르면 문제 발생
    - Stop and Wait 를 통한 해결
        
        응답이 와야만 전송을 시작함
        
        ![Untitled](TCP,%20UDP%200997c/Untitled%202.png)
        
    - Sliding Window 를 통한 해결
        
        윈도우의 크기를 조절하여 전송하는 방법
        
        데이터의 흐름을 동적으로 조절할 수 있다
        
        ![Untitled](TCP,%20UDP%200997c/Untitled%203.png)
        
    
- 혼잡제어(Congestion Control)
    
    한 라우터에 데이터가 몰리는 경우, 이럴 경우 송신측은 다시 데이터를 보내게되고 혼잡이 가중되어 오버플로우나 데이터 손실이 발생한다
    
    - AIMD를 통한 해결
        
        처음에는 window =1 의 패킷을 보내고
        성공했을 시에 window 크기를 1씩 늘려가며 전송하는 방법
        
    - Slow Start 를 통한 해결
        
        AIMD와 동일하게 패킷을 하나씩 보내면서 시작하지만 일정 주기마다 window 의 크기를 2배씩 늘린다 (AIMD의 전송속도 증가량을 보완)
        
    - Fast Retransmit을 통한 해결
        - 패킷을 받는 쪽에서 먼저 도착해야할 패킷이 도착하지 않고 다음 패킷이 도착한 경우에도 ACK 패킷을 보내게 된다.
        - 단, 순서대로 잘 도착한 마지막 패킷의 다음 패킷의 순번을 ACK 패킷에 실어서 보내게 되므로, 중간에 하나가 손실되게 되면 송신 측에서는 순번이 중복된 ACK 패킷을 받게 된다. 이것을 감지하는 순간 문제가 되는 순번의 패킷을 재전송 해줄 수 있다.
        - 중복된 순번의 패킷을 3개 받으면 재전송을 하게 된다. 약간 혼잡한 상황이 일어난 것이므로 혼잡을 감지하고 window size를 줄이게 된다.
    - Fast Recovery를 통한 해결
        
        혼잡 상태에서 window 사이즈를 1/2로 줄이고 다시 AIMD방식으로 window 사이즈를 증가시킨다
        
- 전이중 방식
    
    같은 연결에서 전송이 양뱡향으로 동시에 일어남
    
    최대 세그먼트 크기(MSS)
    
- 점대점 방식
    
    각 연결이 딱 2개의 종단점을 가지고 전송이 일어남.
    
    단일 송신자,  단일 수신자를 가짐
    

### 전송방식

- 송신, 수신 모두 소켓이라는 종단점을 생성하여 연결한다
- Sequence Number와 ACK 을 가지는 전송

![Untitled](TCP,%20UDP%200997c/Untitled%204.png)

- 3-way-handshake (설정)
    
    양쪽 모두 데이터를 전송할 준비가 되어있다는 것을 보장
    
    ![Untitled](TCP,%20UDP%200997c/Untitled%205.png)
    
- , 4-way-handshake (해제)
    - client에서 finish flag 전송 ack 수신
    - sercer에서 finish flag 전송 ack 수신

![Untitled](TCP,%20UDP%200997c/Untitled%206.png)

### 사용처

- 파일전송
- 신뢰성 있는 연결에 사용

### 전송 세그먼트 구조

![Untitled](TCP,%20UDP%200997c/Untitled%207.png)

# 참고

- 패킷과 데이터그램의 차이점
    
    패킷- 일반적인 데이터 덩어리를 지칭
    
    데이터그램- 신뢰할 수 없는 서비스를 통해 전달되는 패킷, 데이터를 전송하는 방식이 불안정하고 전송 실패에 대한 노티피케이션도 없다.
    

# 문제

- UDP 전송 방식에서 오류를 검출하는 방법은?
    
    체크섬 방식
    

- UDP 전송 방식에서 ()을 알 수 없어서 데이터그램 분실 여부를 확인할 수 없다.
    
    Sequence number
    

- 3-way-handshake와 4-way-handshake 의 차이점과 패킷 전송 과정을 설명하시오
    
    3- 연결 설정에 사용
    
    4- 연결 해제에 사용